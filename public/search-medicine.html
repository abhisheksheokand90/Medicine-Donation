<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Search Medicine</title>
  <link rel="stylesheet" href="css/allcss.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">


  <script src="js/angular.min.js"></script>

  <script>
    var module = angular.module("myModule", []);
    module.controller("myController", function ($scope, $http) {


      $scope.fetchCities = function () {

        $http.post("/fetchCities", {}).then(fxGood, fxError)

        function fxGood(response) {

          // alert(JSON.stringify(response.data));
          $scope.jsoncityary = response.data;
        }
        function fxError(error) {

          alert(error.data);
        }
      }







      $scope.fetchMedicines = function () {

        var city = $scope.selCity;

        $http.post("/fetchMedicines", { city: city }).then(fxGood, fxError)


        function fxGood(response) {

          // alert(JSON.stringify(response.data));

          $scope.medicineAry = response.data;
        }
        function fxError(error) {
          alert(error.data);
        }


      }






      $scope.doFetchMedicineDetails = function () {

        var city = $scope.selCity;
        var medicine = document.getElementById("medlist").value;

        $http.post("/fetchMedicineDetails", { city: city, medicine: medicine }).then(fxGood, fxError)

        function fxGood(response) {
          // alert(JSON.stringify(response.data));

          $scope.medicineAryCard = response.data;
        }

        function fxError(error) {
          alert(error.data);
        }
      }






      $scope.displayDonorDetails=function(email){

        $http.post("/displayDonorDetails",{email:email}).then(fxGood,fxError)

        function fxGood(response){
          // alert(JSON.stringify(response.data));
          $scope.donarDetailsAry=response.data;
        }

        function fxError(error){
          alert(JSON.stringify(error.data));
        }
      }

    })
  </script>



</head>

<body ng-app="myModule" ng-controller="myController" ng-init="fetchCities();">
  <h1 class="heading">Search Medicine</h1>

  <div class="container">
    <div class="d-flex justify-content-center gap-5">


      <div class="col-md-3">
        <label for="citylist" class="form-label ms-2">City</label>
        <input class="form-control" list="cityOptions" id="citylist" placeholder="Type to search..." ng-model="selCity"
          ng-change="fetchMedicines();">
        <datalist id="cityOptions">
          <option ng-repeat="obj in jsoncityary" value="{{obj.city}}">{{obj.city}}</option>
        </datalist>
      </div>

      <div class="col-md-3">
        <label for="medlist" class="form-label">Medicines</label>
        <input class="form-control" list="medOptions" id="medlist" placeholder="Type to search...">
        <datalist id="medOptions">
          <option ng-repeat="obj in medicineAry" value="{{obj.medicine}}"> {{obj.medicine}} </option>
        </datalist>
      </div>

    </div>


    <div class="d-flex justify-content-center mt-5">
      <input type="button" class="btn btn-primary" value="Seek Donors" id="btnSeekDonors"
        ng-click="doFetchMedicineDetails()">
    </div>


    <div class="d-flex justify-content-center mt-5">

      <div class="col-md-3" ng-repeat="obj in medicineAryCard">
        <div class="card" style="width: 18rem;">
          <center>
            <img src="uploads/medicines/{{obj.pic}}"
              style="height: 220px; width: 220px; border-radius: 12%; padding: 0px; padding-top: 15px;"
              class="card-img-top card1" alt="...">
            <div class="card-body">
              <h5 class="card-title">{{obj.medicine}}</h5>
              <p class="card-text"> Expiry :- {{(obj.expdate)}} <br> Qyt :- {{obj.qyt}} <br> Packing :- {{obj.packing}}
                <br>Des :- {{obj.description}}</p>
              <a data-bs-toggle="modal" data-bs-target="#exampleModal" class="btn btn-primary" ng-click="displayDonorDetails(obj.email)">Contact Donor</a>
            </div>
          </center>
        </div>
      </div>
    </div>
  </div>










 
   <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Donor Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- <p ng-model="filldetails" > -->
                    <div class="container justify-content-center" ng-repeat="obj in donarDetailsAry">
                        <div class="justify-content-center">
                            You can take {{obj.medicine}} from below Donor :
                        </div>
                        <br>
                        <div class="d-flex gap-3">
                            <div>
                                <img src="uploads/{{obj.donorpic}}" width="150px" height="150px" alt="">
                            </div>
                            <div>
                                Name: {{obj.name}}
                                <br>
                                Email: {{obj.email}}
                                <br>
                                Address: {{obj.addr}}
                                <br>
                                City: {{obj.city}}
                                <br>
                                
                                Contact Number: {{obj.contact}}
                                <br>
                                Contact Time: {{obj.timing}}
                            </div>
                        </div>
                    </div>
                    <!-- </p> -->
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary " data-bs-dismiss="modal">Hope You Will Recover
                        Fast</button>
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                </div>
            </div>
        </div>
    </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>
</body>

</html>